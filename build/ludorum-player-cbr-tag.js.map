{"version":3,"sources":["../src/__prologue__.js","../src/CBRDatabase.js","../src/CBRPlayer.js","../src/__epilogue__.js"],"names":[],"mappings":"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","file":"ludorum-player-cbr-tag.js","sourcesContent":["/** Package wrapper and layout.\n*/\nfunction __init__(base, Sermat, ludorum) { \"use strict\";\n// Import synonyms. ////////////////////////////////////////////////////////////////////////////////\n\tvar declare = base.declare,\n\t\traise = base.raise,\n\t\traiseIf = base.raiseIf,\n\t\tRandomness = base.Randomness,\n\t\tIterable = base.Iterable,\n\t\titerable = base.iterable,\n\t\tFuture = base.Future;\n\n// Library layout. /////////////////////////////////////////////////////////////////////////////////\n\tvar exports = {\n\t\t__package__: 'ludorum-player-cbr',\n\t\t__name__: 'ludorum_player_cbr',\n\t\t__init__: __init__,\n\t\t__dependencies__: [base, Sermat, ludorum],\n\t\t__SERMAT__: { include: [base, ludorum] }\n\t};\n","/** # CBRDatabase \n\n*/\nvar CBRDatabase = base.declare({\n\tconstructor: function CBRDatabase(params) {\n\t\tvar cdb = this;\n\t\tthis.game = params.game;\n\t\tthis.__encoding__ = params.encoding;\n\t\tthis.maxDistance = params.maxDistance || Infinity;\n\t\tthis.minCount = params.minCount || 2;\n\t\tthis.random = params.random || base.Randomness.DEFAULT;\n\t\tthis.__setupDatabase__(this.game);\n\t},\n\n\t__setupDatabase__: function __setupDatabase__(game) {\n\t\tthis.__db__ = new Database('./'+ game.name.toLowerCase() +'-cbr.db');\n\t\tvar encoding = this.encoding(game, game.moves()),\n\t\t\tfeatureColumns = encoding.features.map(function (_, i) {\n\t\t\t\treturn 'f'+ i;\n\t\t\t}),\n\t\t\tactionColumns = game.players.map(function (_, i) {\n\t\t\t\treturn 'a'+ i;\n\t\t\t}),\n\t\t\tresultColumns = base.Iterable.range(game.players.length)\n\t\t\t\t.product(['won', 'tied', 'lost'])\n\t\t\t\t.mapApply(function (p, rt) { // result columns\n\t\t\t\t\treturn rt + p;\n\t\t\t\t}).toArray();\n\t\tvar sql = 'CREATE TABLE IF NOT EXISTS Cases (count INTEGER, '+\n\t\t\tfeatureColumns.concat(actionColumns).concat(resultColumns).map(function (colName) {\n\t\t\t\treturn colName +' INTEGER';\n\t\t\t}).join(', ') +',\\n'+\n\t\t\t'UNIQUE ('+ featureColumns.concat(actionColumns).join(', ') +')'+\n\t\t\t')';\n\t\tthis.__db__.prepare(sql).run();\n\t\tthis.__db__.register({ name: 'distance', deterministic: true, varargs: true },\n\t\t\tthis.distance);\n\t},\n\n\tencoding: function encoding(game, moves) {\n\t\treturn this.__encoding__(game, moves);\n\t},\n\n\tdistance: function distance() {\n\t\tvar r = 0,\n\t\t\tmiddle = (arguments.length / 2) |0,\n\t\t\tn1, n2;\n\t\tfor (var i = 0; i < middle; i++) {\n\t\t\tn1 = arguments[i];\n\t\t\tn2 = arguments[middle + i];\n\t\t\tif (n1 !== null && !isNaN(n1) && n2 !== null && !isNaN(n2)) {\n\t\t\t\tr += Math.abs(n1 - n2);\n\t\t\t}\n\t\t}\n\t\treturn r;\n\t},\n\n\t// Case building //////////////////////////////////////////////////////////////////////////////\n\n\taddCase: function addCase(features, actions, result) {\n\t\tvar players = this.game.players,\n\t\t\tsqlWhere = ' WHERE '+ \n\t\t\t\tfeatures.map(function (f, i) {\n\t\t\t\t\treturn 'f'+ i +(f === null ? ' IS NULL' : ' ='+ f);\n\t\t\t\t}).join(' AND ') +' AND '+\n\t\t\t\tactions.map(function (a, i) {\n\t\t\t\t\treturn 'a'+ i +(a === null ? ' IS NULL' : ' ='+ a);\n\t\t\t\t}).join(' AND '),\n\t\t\tsql;\n\t\tsql = 'SELECT 1 FROM Cases '+ sqlWhere;\n\t\tif (!this.__db__.prepare(sql).get()) {\n\t\t\tsql = 'INSERT INTO Cases VALUES (0,'+ // count\n\t\t\t\tfeatures.map(JSON.stringify).join(',') +', '+\n\t\t\t\tactions.map(JSON.stringify).join(', ') +', '+\n\t\t\t\tbase.Iterable.repeat(0, players.length * 3).join(',') + // result values\n\t\t\t\t')';\n\t\t\tthis.__db__.prepare(sql).run();\n\t\t}\n\t\tsql = 'UPDATE Cases SET count = count + 1, '+\n\t\t\tplayers.map(function (p) {\n\t\t\t\tvar r = result[p],\n\t\t\t\t\tcolumn = (r > 0 ? 'won' : r < 0 ? 'lost' : 'tied') + players.indexOf(p);\n\t\t\t\treturn column +'='+ column +'+1';\n\t\t\t}).join(', ') +' WHERE '+ \n\t\t\tfeatures.map(function (f, i) {\n\t\t\t\treturn 'f'+ i +(f === null ? ' IS NULL' : ' ='+ f);\n\t\t\t}).join(' AND ') +' AND '+\n\t\t\tactions.map(function (a, i) {\n\t\t\t\treturn 'a'+ i +(a === null ? ' IS NULL' : ' ='+ a);\n\t\t\t}).join(' AND ');\n\t\tthis.__db__.prepare(sql).run();\n\t},\n\n\taddMatch: function addMatch(match, randomAdvance) {\n\t\tvar cdb = this,\n\t\t\thistory = [],\n\t\t\tgame;\n\t\t// Random advance\n\t\tif (+randomAdvance > 0) {\n\t\t\tfor (var randomPly = this.random.randomInt(randomAdvance + 1); randomPly > 0; randomPly--) {\n\t\t\t\tgame = match.state(); \n\t\t\t\twhile (game.isContingent) {\n\t\t\t\t\tmatch.__advanceContingents__(random);\n\t\t\t\t\tgame = match.state();\n\t\t\t\t}\n\t\t\t\tmoves = game.moves();\n\t\t\t\tif (moves) {\n\t\t\t\t\tmove = {};\n\t\t\t\t\tgame.activePlayers.forEach(function (activePlayer) {\n\t\t\t\t\t\tmove[activePlayer] = cdb.random.choice(moves[activePlayer]);\n\t\t\t\t\t});\n\t\t\t\t\tmatch.__advance__(game, move);\n\t\t\t\t\thistory.push(cdb.encoding(game, move));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tmatch.events.on('move', function (g, ms) {\n\t\t\tvar data = cdb.encoding(g, ms);\n\t\t\thistory.push(data);\n\t\t});\n\t\treturn match.run().then(function () {\n\t\t\tvar result = match.result(),\n\t\t\t\tcount = 0;\n\t\t\thistory.forEach(function (data) {\n\t\t\t\tcount += cdb.addCase(data.features, data.actions, result);\n\t\t\t});\n\t\t\treturn match;\n\t\t});\n\t},\n\n\taddMatches: function addMatches(matches, randomAdvance) {\n\t\tvar cdb = this,\n\t\t\ti = 0;\n\t\treturn base.Future.sequence(matches, function (match) {\n\t\t\tif ((++i) % 10 === 0) console.log('Training reached '+ i +' matches. '+ (new Date())); //FIXME\n\t\t\treturn cdb.addMatch(match, randomAdvance);\n\t\t});\n\t},\n\n\tpopulate: function populate(options) {\n\t\toptions = options || {};\n\t\tvar cdb = this,\n\t\t\tgame = options.game || this.game,\n\t\t\tn = options.n || 100,\n\t\t\tplayers = options.players || [new ludorum.players.RandomPlayer()],\n\t\t\tmatchups = base.Iterable.product.apply(base.Iterable, \n\t\t\t\tbase.Iterable.repeat(players, game.players.length).toArray()\n\t\t\t).toArray();\n\t\treturn this.addMatches(base.Iterable.range(Math.ceil(n / matchups.length))\n\t\t\t.product(matchups)\n\t\t\t.mapApply(function (i, players) {\n\t\t\t\treturn new ludorum.Match(game, players);\n\t\t\t}), options.maxPly);\n\t},\n\n\t// Database use ///////////////////////////////////////////////////////////////////////////////\n\n\tknn: function knn(n, game, role) {\n\t\tvar cdb = this,\n\t\t\troleIndex = game.players.indexOf(role),\n\t\t\tdata = this.encoding(game);\n\t\tvar resultSet = this.__db__.prepare('SELECT *, distance('+ \n\t\t\tdata.features.map(function (_, i) {\n\t\t\t\treturn 'f'+ i;\n\t\t\t}).join(', ') +', '+ data.features.join(', ') +') AS d '+\n\t\t\t'FROM Cases WHERE a'+ roleIndex +' IS NOT NULL ORDER BY d LIMIT '+ n).all();\n\t\treturn resultSet.map(function (record) {\n\t\t\treturn {\n\t\t\t\tcount: record.count,\n\t\t\t\tfeatures: data.features.map(function (_, i) {\n\t\t\t\t\treturn record['f'+ i]; \n\t\t\t\t}),\n\t\t\t\tactions: base.iterable(game.players).map(function (p, i) {\n\t\t\t\t\treturn [p, record['a'+ i]];\n\t\t\t\t}).toObject(),\n\t\t\t\tresult: base.iterable(game.players).map(function (p, i) {\n\t\t\t\t\treturn [p, [record['won'+ i], record['tied'+ i], record['lost'+ i]]];\n\t\t\t\t}).toObject(),\n\t\t\t\tdistance: record.d\n\t\t\t};\n\t\t});\n\t},\n\n\t// Utilities //////////////////////////////////////////////////////////////////////////////////\n\n\t'static __SERMAT__': {\n\t\tidentifier: 'CBRDatabase',\n\t\tserializer: function serialize_CBRDatabase(obj) {\n\t\t\treturn [{\n\t\t\t\tcases: obj.cases,\n\t\t\t\tfeatureFunction: obj.featureFunction,\n\t\t\t\tmaxDistance: obj.maxDistance\n\t\t\t}];\n\t\t}\n\t},\n}); // declare CBRDatabase","/** # CBR Player \n\n*/\nvar CBRPlayer = base.declare(ludorum.Player, {\n\tconstructor: function CBRPlayer(params) {\n\t\tludorum.Player.call(this, params);\n\t\tthis.caseDB = params && params.caseDB;\n\t\tthis.caseN = params && params.caseN || 20;\n\t},\n\n\tevaluatedMoves: function evaluatedMoves(game, role) {\n\t\tvar caseDB = this.caseDB,\n\t\t\tr = base.iterable(this.movesFor(game, role)).map(function (move) {\n\t\t\t\treturn [move +'', [move, 0]];\n\t\t\t}).toObject();\n\t\tbase.iterable(caseDB.knn(this.caseN, game, role)).forEach(function (_case) {\n\t\t\tvar m = r[_case.actions[role]];\n\t\t\tif (m) {\n\t\t\t\tm[1] += (_case.result[role][0] - _case.result[role][2]) / \n\t\t\t\t\t_case.count; // / (_case.distance + 1);\n\t\t\t}\n\t\t});\n\t\treturn Object.values(r);\n\t},\n\n\tdecision: function decision(game, role) {\n\t\tvar evaluatedMoves = this.evaluatedMoves(game, role),\n\t\t\tbestEval;\n\t\t//console.log(\"evaluatedMoves \"+ JSON.stringify(evaluatedMoves)); //FIXME\n\t\tvar bestMoves = base.iterable(evaluatedMoves).greater(function (t) {\n\t\t\treturn t[1];\n\t\t}).map(function (t) {\n\t\t\tbestEval = t[1];\n\t\t\treturn t[0];\n\t\t});\n\t\t//console.log(\"\\t\"+ bestMoves +\"\\t\"+ bestEval);//FIXME\n\t\tbase.raiseIf(!bestMoves || !bestMoves.length, \n\t\t\t\"No moves where selected at \", game, \" for player \", role, \"!\");\n\t\treturn bestMoves.length === 1 ? bestMoves[0] : base.Randomness.DEFAULT.choice(bestMoves);\n\t},\n\n\t// Utilities. /////////////////////////////////////////////////////////////////////////////////\n\n\tassess: function assess(game, player, n) {\n\t\tvar cbrPlayer = this,\n\t\t\tevaluation = base.iterable(game.players).map(function (p) {\n\t\t\t\treturn [p, [0,0,0]];\n\t\t\t}).toObject(),\n\t\t\tplayers = base.Iterable.repeat(player, game.players.length).toArray();\n\t\tn = +n || 100;\n\t\treturn base.Future.sequence(base.Iterable.range(n), function (i) {\n\t\t\tvar matchPlayers = players.slice(),\n\t\t\t\tplayerIndex = i % game.players.length,\n\t\t\t\tplayerRole = game.players[playerIndex];\n\t\t\tmatchPlayers[playerIndex] = cbrPlayer;\n\t\t\tvar match = new ludorum.Match(game, matchPlayers);\n\t\t\treturn match.run().then(function () {\n\t\t\t\t//console.log(\"Match #\"+ i +\":\\n\\t\"+ match.history.map((g) => g.board).join(\"\\n\\t\"));//FIXME\n\t\t\t\tvar r = match.result()[playerRole];\n\t\t\t\tevaluation[playerRole][r > 0 ? 0 : r < 0 ? 2 : 1]++;\n\t\t\t});\n\t\t}).then(function () {\n\t\t\treturn evaluation;\n\t\t});\n\t}\n}); // declare CBRPlayer","// See __prologue__.js\n\treturn exports;\n}\n"]}