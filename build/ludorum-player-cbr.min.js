//! ludorum-player-cbr 0.0.1

(function(a){"use strict";"function"==typeof define&&define.amd?define(["creatartis-base","sermat","ludorum"],a):"object"==typeof exports&&module.exports?module.exports=a(require("creatartis-base"),require("sermat"),require("ludorum")):this["ludorum-player-cbr"]=a(this.base,this.Sermat,this.ludorum)}).call(this,function a(b,c,d){"use strict";var e=b.declare,f=b.objects.unimplemented,g=(b.raise,b.raiseIf,b.Randomness),h=b.Iterable,i=(b.iterable,b.Future),j={__package__:"ludorum-player-cbr",__name__:"ludorum_player_cbr",__init__:a,__dependencies__:[b,c,d],__SERMAT__:{include:[b,d]},dbs:{}},k=j.CaseBase=b.declare({constructor:function(a){this.game=a&&a.game,a&&"function"==typeof a.encoding&&(this.encoding=a.encoding),this.random=a&&a.random||g.DEFAULT},encoding:f("CaseBase","encoding(game, moves, ply)"),distance:function(a,c){return b.Iterable.zip(a,c).mapApply(function(a,b){return null===n1||isNaN(n1)||null===n2||isNaN(n2)?0:Math.abs(n1-n2)}).sum()},addCase:f("CaseBase","addCase(_case)"),addMatch:function(a,b){var c=this;return a.run().then(function(){var b=a.result(),d=0;return c.game.players.forEach(function(a){b[a]=[b[a]>0?1:0,0===b[a]?1:0,b[a]<0?1:0]}),a.history.forEach(function(a){if(a.moves){var e=c.encoding(a.state,a.moves,d);d++,e.result=b,c.addCase(e)}}),a})},addMatches:function(a,b){var c=this;return i.sequence(a,function(a){return c.addMatch(a,b)})},populate:function(a){a=a||{};var b=a.game||this.game,c=a.n||100,e=a.players||[new d.players.RandomPlayer],f=h.product.apply(h,h.repeat(e,b.players.length).toArray()).toArray();return this.addMatches(h.range(Math.ceil(c/f.length)).product(f).mapApply(function(a,c){return new d.Match(b,c)}),a)},cases:f("CaseBase","cases()"),nn:function(a,b){var c=this,d=(this.encoding(b),this.cases().map(function(a,b){return[a,c.distance(a.features,b.features)]}).sorted(function(a,b){return a[1]-b[1]}));return d.slice(0,+a)},"static __SERMAT__":{identifier:"CaseBase",serializer:function(a){return[{game:a.game,encoding:a.hasOwnProperty("encoding")?a.encoding:null}]}}});j.CBRPlayer=b.declare(d.Player,{constructor:function(a){d.Player.call(this,a),this.caseDB=a&&a.caseDB,this.caseN=a&&a.caseN||20},evaluatedMoves:function(a,c){var d=this.caseDB,e=b.iterable(this.movesFor(a,c)).map(function(a){return[a+"",[a,0]]}).toObject();return b.iterable(d.knn(this.caseN,a,c)).forEach(function(a){var b=e[a.actions[c]];b&&(b[1]+=(a.result[c][0]-a.result[c][2])/a.count)}),Object.values(e)},decision:function(a,c){var d,e=this.evaluatedMoves(a,c),f=b.iterable(e).greater(function(a){return a[1]}).map(function(a){return d=a[1],a[0]});return b.raiseIf(!f||!f.length,"No moves where selected at ",a," for player ",c,"!"),1===f.length?f[0]:b.Randomness.DEFAULT.choice(f)},assess:function(a,c,e){var f=this,g=b.iterable(a.players).map(function(a){return[a,[0,0,0]]}).toObject(),h=b.Iterable.repeat(c,a.players.length).toArray();return e=+e||100,b.Future.sequence(b.Iterable.range(e),function(b){var c=h.slice(),e=b%a.players.length,i=a.players[e];c[e]=f;var j=new d.Match(a,c);return j.run().then(function(){var a=j.result()[i];g[i][a>0?0:a<0?2:1]++})}).then(function(){return g})}}),j.dbs.MemoryCaseBase=e(k,{constructor:function(a){this.__cases__=[],k.call(this,a)},cases:function(){return b.iterable(this.__cases__)},addCase:function(a){var b={features:c.clone(a.features||null),actions:c.clone(a.actions||null),result:c.clone(a.result||null)};return this.__cases__.push(b)},"static __SERMAT__":{identifier:"MemoryCaseBase",serializer:function(a){return k.__SERMAT__.serialize_CaseBase(a)}}});return j});
//# sourceMappingURL=ludorum-player-cbr.min.js.map